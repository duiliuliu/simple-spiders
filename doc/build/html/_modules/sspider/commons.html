<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-ch">
  <head>
    <meta charset="utf-8" />
    <title>sspider.commons &#8212; simple-spiders 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          simple-spiders</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">综述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Install.html">安装使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spider.html">sspider</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../About.html">关于simplespiders</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for sspider.commons</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># author: pengr</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">sspider 通用实现</span>
<span class="sd">~~~~~~~~~~~~</span>

<span class="sd">commons模块下是对spider模块下的接口的通用实现，可直接对commons下的模块组件进行扩展，也可以对spider下的接口直接继承实现</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.spider</span> <span class="k">import</span> <span class="n">AbstractSpider</span><span class="p">,</span> <span class="n">AbstractDownloader</span><span class="p">,</span> <span class="n">AbstractParser</span><span class="p">,</span> <span class="n">AbstractRequestManager</span><span class="p">,</span> <span class="n">AbstractWritter</span><span class="p">,</span> <span class="n">AbstractLogger</span>
<span class="kn">from</span> <span class="nn">requests.models</span> <span class="k">import</span> <span class="n">Response</span> <span class="k">as</span> <span class="n">ParentResponse</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="k">import</span> <span class="n">sessions</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="k">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">typeassert</span><span class="p">,</span> <span class="n">synchronized</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    此模块为对spider模块中抽象架构的通用实现，并确定了传递对象数据结构为Reqeust对象与Response对象，各位在扩展时使用common下的包时需要按照此包下的数据结构进行通信</span>
<span class="sd">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="Request"><a class="viewcode-back" href="../../spider.html#sspider.commons.Request">[docs]</a><span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    请求对象</span>

<span class="sd">    @member :: method : 请求方法，有GET、POST、PUT、DELETE、OPTION \n</span>
<span class="sd">    @member :: url : 请求url \n</span>
<span class="sd">    @member :: params : 请求参数 \n</span>
<span class="sd">    @member :: data : 请求body数据 \n</span>
<span class="sd">    @member :: headers : 请求headers \n</span>
<span class="sd">    @member :: cookies : cookies \n</span>
<span class="sd">    @member :: files : files \n</span>
<span class="sd">    @member :: auth : auth \n</span>
<span class="sd">    @member :: timeout : timeout \n</span>
<span class="sd">    @member :: allow_redirects : allow_redirects \n</span>
<span class="sd">    @member :: proxies : 代理，为字典结构，{&#39;http&#39;:&#39;10.10.154.23:10002&#39;,&#39;https&#39;:&#39;10.10.154.23:10004&#39;} \n</span>
<span class="sd">    @member :: hooks : hooks \n</span>
<span class="sd">    @member :: stream : stream \n</span>
<span class="sd">    @member :: verify : verify \n</span>
<span class="sd">    @member :: cert : cert \n</span>
<span class="sd">    @member :: json : json \n</span>
<span class="sd">    @member :: level : level \n</span>


<span class="sd">    通常开始爬虫时，我们需要初始化一个Request对象或者一组request对象。</span>

<span class="sd">    初始化Request对象，必须初始化其请求方法method与请求url，其余可选</span>
<span class="sd">    `request = Request(&#39;get&#39;,&#39;http://www.baidu.com&#39;)`</span>

<span class="sd">    带有请求头的Request对象</span>
<span class="sd">    `headers = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36&#39;}`</span>
<span class="sd">    `request = Request(&#39;get&#39;,&#39;http://www.baidu.com&#39;, headers=headers)`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__attrs__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;cookies&#39;</span><span class="p">,</span> <span class="s1">&#39;files&#39;</span><span class="p">,</span>
        <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="s1">&#39;allow_redirects&#39;</span><span class="p">,</span> <span class="s1">&#39;proxies&#39;</span><span class="p">,</span> <span class="s1">&#39;hooks&#39;</span><span class="p">,</span> <span class="s1">&#39;stream&#39;</span><span class="p">,</span>
        <span class="s1">&#39;verify&#39;</span><span class="p">,</span> <span class="s1">&#39;cert&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span>
                 <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">auth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">hooks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="n">cookies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">auth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_redirects</span> <span class="o">=</span> <span class="n">allow_redirects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="n">proxies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span> <span class="o">=</span> <span class="n">hooks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">verify</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="n">cert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="n">json</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<div class="viewcode-block" id="Request.transRequestParam"><a class="viewcode-back" href="../../spider.html#sspider.commons.Request.transRequestParam">[docs]</a>    <span class="k">def</span> <span class="nf">transRequestParam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span></div></div>


<div class="viewcode-block" id="Response"><a class="viewcode-back" href="../../spider.html#sspider.commons.Response">[docs]</a><span class="k">class</span> <span class="nc">Response</span><span class="p">(</span><span class="n">ParentResponse</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    响应对象</span>

<span class="sd">    @member :: _content : 响应二进制数据 \n</span>
<span class="sd">    @member :: _content_consumed : _content_consumed \n</span>
<span class="sd">    @member :: _next : _next \n</span>
<span class="sd">    @member :: status_code : 响应状态码 \n</span>
<span class="sd">    @member :: headers : 响应头 \n</span>
<span class="sd">    @member :: raw : raw \n</span>
<span class="sd">    @member :: url : 请求url \n</span>
<span class="sd">    @member :: encoding : 响应编码 \n</span>
<span class="sd">    @member :: history : 响应历史 \n</span>
<span class="sd">    @member :: reason : reason \n</span>
<span class="sd">    @member :: cookies : 响应cookies \n</span>
<span class="sd">    @member :: elapsed : elapsed \n</span>
<span class="sd">    @member :: request : request \n</span>
<span class="sd">    @member :: level : 对应request的level \n</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_content_consumed</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_content_consumed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_next</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">status_code</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">headers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">raw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">encoding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">reason</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cookies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">elapsed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">level</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<div class="viewcode-block" id="Response.html"><a class="viewcode-back" href="../../spider.html#sspider.commons.Response.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        将response解析为HtmlElement对象，可通过css选择器或者xpath语法获取数据</span>

<span class="sd">        如：</span>
<span class="sd">            &gt;&gt;&gt; doc = response.html()</span>
<span class="sd">            &gt;&gt;&gt; # 通过xpath获取a元素里的href</span>
<span class="sd">            &gt;&gt;&gt; links = doc.xpath(&#39;//a/@href&#39;)</span>
<span class="sd">            &gt;&gt;&gt; # 通过xpath获取span元素中的text</span>
<span class="sd">            &gt;&gt;&gt; spans = doc.xpath(&#39;//span/text()&#39;)</span>
<span class="sd">            &gt;&gt;&gt; # 更多用法，请自行查询css选择器与xpath语法进行使用</span>

<span class="sd">            常用方法：</span>
<span class="sd">            find, findall, findtext, get, getchildren, getiterator, getnext, getparent, getprevious, getroottree, index, insert, items, iter, iterancestors, iterchildren, iterdescendants, iterfind, itersiblings, itertext, keys, makeelement, remove, replace, values, xpath</span>

<span class="sd">            &gt;&gt;&gt; .drop_tree():</span>
<span class="sd">            Drops the element and all its children. Unlike el.getparent().remove(el) this does not remove the tail text; with drop_tree the tail text is merged with the previous element.</span>
<span class="sd">            &gt;&gt;&gt; .drop_tag():</span>
<span class="sd">            Drops the tag, but keeps its children and text.</span>
<span class="sd">            &gt;&gt;&gt; .find_class(class_name):</span>
<span class="sd">            Returns a list of all the elements with the given CSS class name. Note that class names are space separated in HTML, so doc.find_class_name(&#39;highlight&#39;) will find an element like &lt;div class=&quot;sidebar highlight&quot;&gt;. Class names are case sensitive.</span>
<span class="sd">            &gt;&gt;&gt; .find_rel_links(rel):</span>
<span class="sd">            Returns a list of all the &lt;a rel=&quot;{rel}&quot;&gt; elements. E.g., doc.find_rel_links(&#39;tag&#39;) returns all the links marked as tags.</span>
<span class="sd">            &gt;&gt;&gt; .get_element_by_id(id, default=None):</span>
<span class="sd">            Return the element with the given id, or the default if none is found. If there are multiple elements with the same id (which there shouldn&#39;t be, but there often is), this returns only the first.</span>
<span class="sd">            &gt;&gt;&gt; .text_content():</span>
<span class="sd">            Returns the text content of the element, including the text content of its children, with no markup.</span>
<span class="sd">            &gt;&gt;&gt; .cssselect(expr):</span>
<span class="sd">            Select elements from this element and its children, using a CSS selector expression. (Note that .xpath(expr) is also available as on all lxml elements.)</span>
<span class="sd">            &gt;&gt;&gt; .label:</span>
<span class="sd">            Returns the corresponding &lt;label&gt; element for this element, if any exists (None if there is none). Label elements have a label.for_element attribute that points back to the element.</span>
<span class="sd">            &gt;&gt; .base_url:</span>
<span class="sd">            The base URL for this element, if one was saved from the parsing. This attribute is not settable. Is None when no base URL was saved.</span>
<span class="sd">            &gt;&gt;&gt; .classes:</span>
<span class="sd">            Returns a set-like object that allows accessing and modifying the names in the &#39;class&#39; attribute of the element. (New in lxml 3.5).</span>
<span class="sd">            &gt;&gt;&gt; .set(key, value=None):</span>
<span class="sd">            Sets an HTML attribute. If no value is given, or if the value is None, it creates a boolean attribute like &lt;form novalidate&gt;&lt;/form&gt; or &lt;div custom-attribute&gt;&lt;/div&gt;. In XML, attributes must have at least the empty string as their value like &lt;form novalidate=&quot;&quot;&gt;&lt;/form&gt;, but HTML boolean attributes can also be just present or absent from an element without having a value.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HtmlDownloader"><a class="viewcode-back" href="../../spider.html#sspider.commons.HtmlDownloader">[docs]</a><span class="k">class</span> <span class="nc">HtmlDownloader</span><span class="p">(</span><span class="n">AbstractDownloader</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    下载器</span>

<span class="sd">    对传入的请求进行请求下载</span>

<span class="sd">    @member :: timeout : 下载超时时间</span>

<span class="sd">    对与下载器下载前后，很多时候都需要进行一些扩展中间件，在此框架中，可以运用装饰者模式对其进行扩展，也可以自己继承实现 AbstractDownloader 接口中的方法。</span>

<span class="sd">    例如：通过装饰器实现添加代理</span>

<span class="sd">        &gt;&gt;&gt; # 我们需要一个代理池（可将代理池设置为单例类），类似与requestManager.假定我们得代理池如下：</span>
<span class="sd">        &gt;&gt;&gt; class ProxyPool(object):</span>
<span class="sd">        &gt;&gt;&gt;     def get_new_proxy:</span>
<span class="sd">        &gt;&gt;&gt;         &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt;         请求代理，返回一个可用的、未被使用过的代理</span>
<span class="sd">        &gt;&gt;&gt;             return proxy</span>
<span class="sd">        &gt;&gt;&gt;         &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt;         passs</span>
<span class="sd">        &gt;&gt;&gt; def proxyWrapper():</span>
<span class="sd">        &gt;&gt;&gt;     &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt;     通过装饰器给请求动态添加代理</span>
<span class="sd">        &gt;&gt;&gt;     &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; def decorate(func):</span>
<span class="sd">        &gt;&gt;&gt;         @wraps(func)</span>
<span class="sd">        &gt;&gt;&gt;         def wrapper(request):</span>
<span class="sd">        &gt;&gt;&gt;             proxy = ProxyPool().get_new_proxy()</span>
<span class="sd">        &gt;&gt;&gt;             request.proxy = proxy</span>
<span class="sd">        &gt;&gt;&gt;             return func(*args, **kwargs)</span>
<span class="sd">        &gt;&gt;&gt;         return wrapper</span>
<span class="sd">        &gt;&gt;&gt;     return decorate</span>

<span class="sd">        完成代理的装饰器后可直接在 download 方法中进行使用：</span>


<span class="sd">        &gt;&gt;&gt; @typeassert(request=Request)</span>
<span class="sd">        &gt;&gt;&gt; @proxyWrapper</span>
<span class="sd">        &gt;&gt;&gt; def download(self, request):</span>
<span class="sd">        &gt;&gt;&gt;     with sessions.Session() as session:</span>
<span class="sd">        &gt;&gt;&gt;         return Response(request, cls=session.request(**request.TransRequestParam()))</span>

<span class="sd">    同样的，也可以将下载单元加入单线程、多进程进行下载请求资源，这样就与解析异步进行，提高爬取效率</span>
<span class="sd">    对于cookie，请求头等的设置类似上面代理装饰器</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

<div class="viewcode-block" id="HtmlDownloader.download"><a class="viewcode-back" href="../../spider.html#sspider.commons.HtmlDownloader.download">[docs]</a>    <span class="nd">@typeassert</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">Request</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
        <span class="k">with</span> <span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="o">.</span><span class="n">transRequestParam</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="HtmlParser"><a class="viewcode-back" href="../../spider.html#sspider.commons.HtmlParser">[docs]</a><span class="k">class</span> <span class="nc">HtmlParser</span><span class="p">(</span><span class="n">AbstractParser</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    解析器</span>

<span class="sd">    对传入的文本进行解析</span>

<span class="sd">    在爬取网页中，这部分时很难统一的，各个网站有不同的特色，所以此部分是一般需要用户自己独立重写的</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="HtmlParser.parse"><a class="viewcode-back" href="../../spider.html#sspider.commons.HtmlParser.parse">[docs]</a>    <span class="nd">@typeassert</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">Response</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">htm</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">htm</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;get&#39;</span>
            <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">datas</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">htm</span><span class="o">.</span><span class="n">itertext</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">requests</span><span class="p">,</span> <span class="n">datas</span></div></div>


<span class="kn">import</span> <span class="nn">hashlib</span>


<div class="viewcode-block" id="RequestManager"><a class="viewcode-back" href="../../spider.html#sspider.commons.RequestManager">[docs]</a><span class="k">class</span> <span class="nc">RequestManager</span><span class="p">(</span><span class="n">AbstractRequestManager</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    请求管理器</span>

<span class="sd">    管理所有的请求</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        请求管理器初始化函数</span>

<span class="sd">            @param :: limit_level : 爬取层数限制，默认限制3层 \n</span>
<span class="sd">            @member :: level : 当前爬取层数 \n</span>
<span class="sd">            @member :: new_requests : 未爬取请求集合，采用字典存储，key对应相应的层数，value相应层数未请求的请求集合 \n</span>
<span class="sd">            @member :: old_requests : 已存储请求集合，采用元组存储，每个请求计算128位md5码进行存储 \n</span>
<span class="sd">            @member :: limit_level : 爬取层数限制，默认限制3层 \n</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__old_requests</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__limit_level</span> <span class="o">=</span> <span class="n">limit_level</span>

<div class="viewcode-block" id="RequestManager.add_new_request"><a class="viewcode-back" href="../../spider.html#sspider.commons.RequestManager.add_new_request">[docs]</a>    <span class="nd">@typeassert</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">Request</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_new_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        添加请求</span>

<span class="sd">            @param :: request : Request请求</span>

<span class="sd">            return : None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__old_requests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_new_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_old_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestManager.has_new_request"><a class="viewcode-back" href="../../spider.html#sspider.commons.RequestManager.has_new_request">[docs]</a>    <span class="k">def</span> <span class="nf">has_new_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        判断是否还有待爬取的请求，当传入level后，判断相应的层数中是否还有待爬取的请求。默认判断所有层数</span>

<span class="sd">            @param :: level : 待添加请求集合</span>

<span class="sd">            return : Bool</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_requests_size</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="RequestManager.get_new_request"><a class="viewcode-back" href="../../spider.html#sspider.commons.RequestManager.get_new_request">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        获取一个未被请求过的请求</span>

<span class="sd">            @param :: level : 从指定层数中提取，默认为None</span>

<span class="sd">            return : request</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_request</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__level</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__level</span><span class="p">)])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_level</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_new_request</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        获取当前层级</span>

<span class="sd">            return : int</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__level</span>

<div class="viewcode-block" id="RequestManager.new_requests_size"><a class="viewcode-back" href="../../spider.html#sspider.commons.RequestManager.new_requests_size">[docs]</a>    <span class="k">def</span> <span class="nf">new_requests_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        待爬取的请求集合长度</span>

<span class="sd">            @param :: level : 获取指定层数的请求集合长度</span>

<span class="sd">            return : int</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">level</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_request_size</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_request_size</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">))</span></div>

<div class="viewcode-block" id="RequestManager.old_requests_size"><a class="viewcode-back" href="../../spider.html#sspider.commons.RequestManager.old_requests_size">[docs]</a>    <span class="k">def</span> <span class="nf">old_requests_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        已请求的请求集合长度</span>

<span class="sd">            @param :: level : 获取指定层数的请求集合长度</span>

<span class="sd">            return : int</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__old_requests</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (私有函数)增加当前爬取层数</span>

<span class="sd">            return : None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__level</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__init_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (私有函数)初始化level层的待爬取请求集合</span>

<span class="sd">            @param :: level : 指定要初始化的level层</span>

<span class="sd">            return : None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__add_new_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (私有函数)添加请求,向未爬取过的请求集合中添加请求</span>

<span class="sd">            @param :: requests : 待添加请求</span>

<span class="sd">            return : None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__level</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init_level</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__level</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">level</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__limit_level</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">level</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init_level</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">level</span><span class="p">)]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add_old_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (私有函数)添加请求,向已爬取过的请求集合中添加请求。集合中添加请求文本的128位md5码</span>

<span class="sd">            @param :: request : 待添加请求文本</span>

<span class="sd">            return : None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__old_requests</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">8</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__get_new_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (私有函数)获取一个未被请求过的请求</span>

<span class="sd">            @param :: level : 从指定层数中提取</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__new_request_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (私有函数)获取level层未爬取的请求集合长度</span>

<span class="sd">            @param :: level : 从指定层数中提取</span>

<span class="sd">            return : int</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__new_requests</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)])</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<span class="kn">import</span> <span class="nn">pickle</span>


<div class="viewcode-block" id="CommonWritter"><a class="viewcode-back" href="../../spider.html#sspider.commons.CommonWritter">[docs]</a><span class="k">class</span> <span class="nc">CommonWritter</span><span class="p">(</span><span class="n">AbstractWritter</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    数据写入类</span>

<span class="sd">    将数据以特定格式写入到磁盘中</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_file</span> <span class="o">=</span> <span class="s1">&#39;buffer_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_buffer</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_file</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="nd">@headers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">h</span><span class="p">:</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;未知类型的headers&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CommonWritter.write"><a class="viewcode-back" href="../../spider.html#sspider.commons.CommonWritter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@synchronized</span>
    <span class="k">def</span> <span class="nf">write_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__addListItems</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__addDictItems</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;未知类型的headers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_buffer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_buffer</span><span class="p">()</span>

    <span class="nd">@synchronized</span>
    <span class="k">def</span> <span class="nf">flush_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_file</span><span class="p">,</span> <span class="s1">&#39;wb+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[:]</span>

    <span class="nd">@synchronized</span>
    <span class="k">def</span> <span class="nf">remove_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__addDictItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictItems</span><span class="p">):</span>
        <span class="n">tempHeaders</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dictItems</span><span class="p">}</span>
        <span class="n">tempHeaders</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">tempHeaders</span>
        <span class="n">tempList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dictItems</span><span class="p">:</span>
                <span class="n">tempList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictItems</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tempList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempList</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__addListItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listItems</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listItems</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_buffer</span><span class="p">()</span></div>


<div class="viewcode-block" id="TxtWritter"><a class="viewcode-back" href="../../spider.html#sspider.commons.TxtWritter">[docs]</a><span class="k">class</span> <span class="nc">TxtWritter</span><span class="p">(</span><span class="n">CommonWritter</span><span class="p">):</span>

<div class="viewcode-block" id="TxtWritter.write"><a class="viewcode-back" href="../../spider.html#sspider.commons.TxtWritter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>


<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">set_color</span><span class="p">,</span> <span class="n">FOREGROUND_GREEN</span><span class="p">,</span> <span class="n">FOREGROUND_YELLOW</span><span class="p">,</span> <span class="n">FOREGROUND_BLUE</span><span class="p">,</span> <span class="n">FOREGROUND_RED</span><span class="p">,</span> <span class="n">FOREGROUND_WHITE</span>


<div class="viewcode-block" id="Logger"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger">[docs]</a><span class="k">class</span> <span class="nc">Logger</span><span class="p">(</span><span class="n">AbstractLogger</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">Flevel</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        日志类</span>

<span class="sd">            @param :: name : 日志名称</span>
<span class="sd">            @member :: clevel : 打印控制台级别</span>
<span class="sd">            @member :: Flevel : 输出日志文件级别</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="c1"># 设置CMD日志</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">clevel</span><span class="p">)</span>
        <span class="c1"># 设置文件日志</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.log&#39;</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">Flevel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>

<div class="viewcode-block" id="Logger.debug"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.info"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger.info">[docs]</a>    <span class="nd">@set_color</span><span class="p">(</span><span class="n">FOREGROUND_GREEN</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.warn"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger.warn">[docs]</a>    <span class="nd">@set_color</span><span class="p">(</span><span class="n">FOREGROUND_YELLOW</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.exception"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger.exception">[docs]</a>    <span class="nd">@set_color</span><span class="p">(</span><span class="n">FOREGROUND_RED</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.error"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger.error">[docs]</a>    <span class="nd">@set_color</span><span class="p">(</span><span class="n">FOREGROUND_RED</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.cri"><a class="viewcode-back" href="../../spider.html#sspider.commons.Logger.cri">[docs]</a>    <span class="k">def</span> <span class="nf">cri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Spider"><a class="viewcode-back" href="../../spider.html#sspider.commons.Spider">[docs]</a><span class="k">class</span> <span class="nc">Spider</span><span class="p">(</span><span class="n">AbstractSpider</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="o">=</span><span class="n">HtmlDownloader</span><span class="p">(),</span> <span class="n">parser</span><span class="o">=</span><span class="n">HtmlParser</span><span class="p">(),</span> <span class="n">requestManager</span><span class="o">=</span><span class="n">RequestManager</span><span class="p">(),</span> <span class="n">writter</span><span class="o">=</span><span class="n">CommonWritter</span><span class="p">(),</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Logger</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">downloader</span><span class="o">=</span><span class="n">downloader</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span>
                         <span class="n">requestManager</span><span class="o">=</span><span class="n">requestManager</span><span class="p">,</span> <span class="n">writter</span><span class="o">=</span><span class="n">writter</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

<div class="viewcode-block" id="Spider.write"><a class="viewcode-back" href="../../spider.html#sspider.commons.Spider.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        将数据写入磁盘，依赖于初始化Spider时的writter，默认为CommonWritter，即将数据打印到控制台</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Spider.getItems"><a class="viewcode-back" href="../../spider.html#sspider.commons.Spider.getItems">[docs]</a>    <span class="k">def</span> <span class="nf">getItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        获取抓取到的数据</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writter</span><span class="o">.</span><span class="n">items</span></div></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, pengr.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>